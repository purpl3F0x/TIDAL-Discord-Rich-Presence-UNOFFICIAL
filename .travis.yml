language: cpp

compiler:
  - cmake

jobs:
  allow_failures:
    - os: windows
  include:
    - os: osx
    - os: windows

before_cache:
  - if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      $msys2 pacman --sync --clean --noconfirm ;
    fi

cache:
  directories:
    - $HOME/AppData/Local/Temp/chocolatey
    - /C/tools/msys64

addons:
  homebrew:
    packages:
      - qt

script:
  - if [[ $TRAVIS_OS_NAME == "windows" ]]; then
      export "PATH=/c/tools/msys64/mingw64/bin:$PATH";
      cmake . ;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 
      cmake . && make ;
    fi

after_success:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 
      zip -r tidal-rpc-osx.zip tidal-rpc.app ;
    fi
  - if [[ "$TRAVIS_OS_NAME" == "windows" ]]; then
      zip -r tidal-rpc-win.zip tidal-rpc.exe ;
    fi

deploy:
  provider: releases
  api_key: $GITHUB_OAUTH_TOKEN
  file:
    - "tidal-rpc-osx.zip"
    - "tidal-rpc-win.zip"
  skip_cleanup: true
  draft: true


  